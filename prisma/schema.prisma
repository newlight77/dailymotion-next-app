// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model Anime {
  uid        String   @id @default(uuid())
  title      String
  updateDays String
  type       String
  status     String
  summary    String
  thumbnail  String
  thumbnailFilename  String
  studio     String

  releaseAt    DateTime
  updatedAt    DateTime
  publishedAt  DateTime
  publishedBy  String?

  subtitle      String?
  originalTitle String?
  firstSeasonEpisode   Int?
  lastSeasonEpisode   Int?
  totalSeasonEpisodes Int?
  lastEpisode   Int?
  totalEpisodes Int?

  watchListItems WatchListItem[]
  ratings        Rating[]
  comments       Comment[]
  reviews        Review[]
}

model WatchList {
  uid          String          @id @default(uuid())
  title        String
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  items        WatchListItem[]

  ownerId  String?
  isPublic Boolean @default(false)
  owner    AuthUser? @relation(fields: [ownerId], references: [uid], onDelete: SetNull)
}

model WatchListItem {
  uid       String   @id @default(uuid())
  listId    String
  animeId   String
  createdAt DateTime @default(now())

  list  WatchList @relation(fields: [listId], references: [uid], onDelete: Cascade)
  anime Anime     @relation(fields: [animeId], references: [uid])

  @@unique([listId, animeId])
}

model AuthUser {
  uid          String   @id @default(uuid())
  username     String   @unique
  email        String?  @unique
  name         String?
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  watchLists           WatchList[]
  followedVideoOwners  FollowedVideoOwner[]
  ratings              Rating[]
  comments             Comment[]
  reviews              Review[]
}

model FollowedVideoOwner {
  uid       String   @id @default(uuid())
  userId    String
  owner     String
  order     Int      @default(0)
  createdAt DateTime @default(now())

  user AuthUser @relation(fields: [userId], references: [uid], onDelete: Cascade)

  @@unique([userId, owner])
}

model Rating {
  uid       String   @id @default(uuid())
  animeId   String
  ownerId   String
  value     Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  anime  Anime    @relation(fields: [animeId], references: [uid], onDelete: Cascade)
  owner  AuthUser @relation(fields: [ownerId], references: [uid], onDelete: Cascade)
  review Review?

  @@unique([animeId, ownerId])
}

model Comment {
  uid       String   @id @default(uuid())
  animeId   String
  ownerId   String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  anime  Anime    @relation(fields: [animeId], references: [uid], onDelete: Cascade)
  owner  AuthUser @relation(fields: [ownerId], references: [uid], onDelete: Cascade)
  review Review?

  @@unique([animeId, ownerId])
}

model Review {
  uid       String   @id @default(uuid())
  animeId   String
  ownerId   String
  ratingId  String   @unique
  commentId String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  anime   Anime    @relation(fields: [animeId], references: [uid], onDelete: Cascade)
  owner   AuthUser @relation(fields: [ownerId], references: [uid], onDelete: Cascade)
  rating  Rating   @relation(fields: [ratingId], references: [uid], onDelete: Cascade)
  comment Comment  @relation(fields: [commentId], references: [uid], onDelete: Cascade)

  @@unique([animeId, ownerId])
}
